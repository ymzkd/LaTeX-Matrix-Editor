# LaTeX Matrix Editor - 仕様書

## 概要

LaTeX Matrix Editorは、LaTeX形式の行列を視覚的かつ効率的に編集するためのWebアプリケーションです。従来のテキストエディタでは困難だった複雑な数式を含む大きな行列の編集を、直感的なセル選択方式とリアルタイムプレビューにより大幅に効率化します。

### 主な特徴

- **視覚的編集**: 行列をテーブル形式で表示し、セル単位での編集が可能
- **リアルタイムプレビュー**: 編集内容をKaTeXによりリアルタイムで数式レンダリング
- **LaTeX互換**: 既存のLaTeXコードの読み取りと新規LaTeXコード生成に対応
- **対称行列サポート**: 対称行列の編集時に自動的に対称位置を同期更新
- **スケーラブル表示**: 長い数式もセル内に収まるよう自動スケール調整

---

## 技術仕様

### 使用技術

- **フロントエンド**: React (Hooks)
- **数式レンダリング**: KaTeX v0.16.8
- **スタイリング**: Tailwind CSS
- **実行環境**: ブラウザ（モダンブラウザ対応）

### 動作要件

- JavaScript対応ブラウザ
- インターネット接続（KaTeX CDN使用）
- 推奨解像度: 1200px以上

### データ構造

```javascript
// 行列データ構造
{
  type: 'pmatrix',        // 行列タイプ
  rows: 3,                // 行数
  cols: 3,                // 列数
  cells: [                // セルデータ（2次元配列）
    ['a_{11}', 'a_{12}', 'a_{13}'],
    ['a_{21}', 'a_{22}', 'a_{23}'],
    ['a_{31}', 'a_{32}', 'a_{33}']
  ]
}

// アクティブセル
{
  row: 0,                 // 選択行（0インデックス）
  col: 0                  // 選択列（0インデックス）
}
```

---

## 機能仕様

### 1. 基本編集機能

#### 1.1 セル選択・編集
- **セル選択**: クリックまたはキーボードナビゲーションでセル選択
- **専用編集ボックス**: 選択されたセルの内容を下部テキストボックスで編集
- **リアルタイム反映**: 編集内容が即座にセル表示とプレビューに反映

#### 1.2 数式レンダリング
- **セル内レンダリング**: 各セルでLaTeX数式をKaTeXレンダリング
- **自動スケール**: 長い数式は自動的にセルサイズに合わせて縮小表示
- **フォールバック**: レンダリング失敗時はプレーンテキスト表示

#### 1.3 キーボードナビゲーション
- **Tab/Shift+Tab**: 右/左方向のセル移動
- **矢印キー**: 上下左右方向のセル移動
- **Enter**: 下方向のセル移動
- **循環移動**: 端に到達すると反対側に移動

### 2. 行列操作機能

#### 2.1 サイズ変更
- **行追加**: 選択セルの行の後に新しい行を挿入
- **行削除**: 選択セルの行を削除（最小1行）
- **列追加**: 選択セルの列の後に新しい列を挿入
- **列削除**: 選択セルの列を削除（最小1列）

#### 2.2 行列タイプ
| タイプ | 表示形式 | LaTeX環境 |
|--------|----------|-----------|
| matrix | 括弧なし | `\begin{matrix}` |
| pmatrix | 丸括弧 () | `\begin{pmatrix}` |
| bmatrix | 角括弧 [] | `\begin{bmatrix}` |
| vmatrix | 単線 \|\| | `\begin{vmatrix}` |
| Vmatrix | 二重線 \|\|\|\| | `\begin{Vmatrix}` |
| smallmatrix | 小サイズ | `\begin{smallmatrix}` |

### 3. プリセット機能

#### 3.1 標準プリセット
- **Identity**: 単位行列（対角成分が1、その他が0）
- **Zero**: 零行列（全成分が0）
- **Clear**: 空行列（全成分が空文字）

#### 3.2 対称行列プリセット
- **Symmetric**: 対称行列のサンプル生成（正方行列のみ）

### 4. 対称行列モード

#### 4.1 基本機能
- **有効条件**: 正方行列でのみ利用可能
- **自動同期**: 非対角成分 a_{ij} の編集時に a_{ji} も自動更新
- **視覚フィードバック**: 対称ペアセルを紫色でハイライト

#### 4.2 操作機能
- **モード切り替え**: ON/OFFボタンによる切り替え
- **Make Symmetric**: 既存行列を対称行列に変換（上三角→下三角コピー）
- **自動無効化**: 非正方行列になった場合の自動モード解除

### 5. LaTeXコード機能

#### 5.1 コード生成
- **リアルタイム生成**: 編集に応じてLaTeXコード自動生成
- **コピー機能**: ワンクリックでクリップボードにコピー
- **完全なLaTeX**: 他の文書にそのまま貼り付け可能

#### 5.2 コード読み取り
- **手動入力**: テキストエリアでの直接編集
- **自動解析**: 0.5秒のデバウンス後に自動解析
- **インポート機能**: ポップアップ経由での一括読み込み
- **エラーハンドリング**: 解析失敗時の適切なエラー表示

### 6. プレビュー機能

#### 6.1 リアルタイムプレビュー
- **KaTeXレンダリング**: 高品質な数式表示
- **選択セルハイライト**: 編集中セルの対応部分を赤色・太字で表示
- **自動更新**: セル内容変更時の即座更新

---

## ユーザーインターフェース

### レイアウト構成

```
+------------------+------------------+
|                  |                  |
|  Matrix Editor   |     Preview      |
|                  |                  |
|  [Controls]      |  [Rendered Math] |
|  [Matrix Table]  |                  |
|  [Cell Editor]   |  [LaTeX Code]    |
|                  |                  |
+------------------+------------------+
```

### エディタ部分（左側）

1. **制御パネル**
   - 行列タイプ選択ドロップダウン
   - サイズ制御ボタン（+Row, -Row, +Col, -Col）
   - 現在選択位置表示
   - プリセットボタン群
   - 対称行列モード制御

2. **行列テーブル**
   - セルごとの数式レンダリング表示
   - 選択セルの青色ハイライト
   - 対称ペアセルの紫色ハイライト（対称モード時）

3. **セル編集ボックス**
   - 選択セル位置表示
   - LaTeX構文対応テキスト入力
   - リアルタイム反映

### プレビュー部分（右側）

1. **数式プレビュー**
   - KaTeXによる高品質レンダリング
   - 選択セルの赤色ハイライト

2. **LaTeXコード**
   - 編集可能テキストエリア
   - コピーボタン
   - 自動解析機能

---

## 使用方法

### 基本操作手順

1. **新規作成**
   - アプリを開くと3×3のサンプル行列が表示
   - セルをクリックして選択
   - 下部テキストボックスで内容編集

2. **行列サイズ調整**
   - 編集したいセルを選択
   - +Row/-Row, +Col/-Colボタンで行列サイズ調整

3. **行列タイプ選択**
   - ドロップダウンメニューから適切な括弧タイプを選択

4. **LaTeXコード取得**
   - 右下のテキストエリアからコピーボタンでコード取得

### 対称行列編集

1. **正方行列作成**
   - 行数と列数を同じにする

2. **対称モード有効化**
   - 「Symmetric Matrix Mode」をONに設定

3. **編集**
   - 非対角成分を編集すると対称位置も自動更新
   - 紫色ハイライトで対称ペアを確認

### 既存LaTeXコード編集

1. **コード読み込み**
   - 右下テキストエリアに既存LaTeXコードを貼り付け
   - または「Import LaTeX」ボタンを使用

2. **自動解析**
   - 0.5秒後に自動的にエディタに反映

3. **編集継続**
   - 通常通りセル編集で内容修正

---

## LaTeX構文サポート

### 対応構文
- **上付き・下付き**: `x^2`, `a_{ij}`
- **分数**: `\frac{1}{2}`
- **平方根**: `\sqrt{x}`, `\sqrt[3]{x}`
- **ギリシャ文字**: `\alpha`, `\beta`, `\gamma`
- **数学記号**: `\sum`, `\int`, `\infty`
- **その他**: KaTeX対応のすべての構文

### 入力例
```latex
\frac{x^2 + 1}{\sqrt{y}}
\sum_{i=1}^{n} a_i
\alpha\beta\gamma
```

---

## 制限事項・注意点

### 技術的制限
- **ブラウザストレージ**: データ保存機能なし（セッション限り）
- **ファイル出力**: 画像エクスポート未実装
- **印刷**: ブラウザ印刷機能に依存

### 機能制限
- **最大サイズ**: 実用上の制限なし（パフォーマンス考慮推奨）
- **対称行列**: 正方行列のみ対応
- **LaTeX解析**: 基本的な行列環境のみ対応

### 使用上の注意
- **自動保存なし**: リロード時にデータ消失
- **エラー処理**: 不正なLaTeX構文時の表示崩れ可能性
- **ブラウザ互換性**: IE非対応

---

## 今後の拡張可能性

### 機能拡張案
1. **データ永続化**
   - ローカルストレージ対応
   - クラウド保存機能

2. **出力機能強化**
   - PNG/SVG画像エクスポート
   - PDF出力
   - 複数形式対応

3. **編集機能強化**
   - Undo/Redo機能
   - 範囲選択・一括編集
   - 数式テンプレート機能

4. **UI/UX改善**
   - レスポンシブ対応
   - テーマ変更機能
   - キーボードショートカット拡充

5. **高度な行列操作**
   - 行列演算機能
   - ブロック行列対応
   - スパース行列表示

### 技術改善案
1. **パフォーマンス最適化**
   - 仮想スクロール実装
   - 大規模行列対応

2. **アクセシビリティ**
   - スクリーンリーダー対応
   - キーボード操作完全対応

3. **エラーハンドリング**
   - 詳細エラーメッセージ
   - 自動修復機能

---

## 開発履歴

### バージョン情報
- **プロトタイプ v1.0** (2025年7月)
  - 基本編集機能実装
  - リアルタイムプレビュー
  - 対称行列モード
  - LaTeX読み取り・生成機能

### 実装順序
1. 基本行列エディタ
2. KaTeXレンダリング統合
3. セル表示改善（スケール機能）
4. LaTeX読み取り機能
5. 対称行列モード
6. 行・列操作改善

---

## まとめ

LaTeX Matrix Editorは、従来のテキストベース編集の課題を解決する革新的なツールです。視覚的な編集インターフェースとリアルタイムプレビューにより、複雑な数式を含む大規模行列の編集作業を大幅に効率化します。

特に学術研究、教育現場、技術文書作成において、高品質なLaTeX行列を簡単に作成・編集できる環境を提供し、ユーザーの生産性向上に貢献します。